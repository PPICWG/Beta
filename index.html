<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitung Muat Kotak Kontainer - Professional 3D</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.05"><circle cx="30" cy="30" r="2"/></g></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .main-container {
            position: relative;
            z-index: 1;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gradient-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .gradient-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .gradient-button:hover::before {
            left: 100%;
        }

        .gradient-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -12px rgba(102, 126, 234, 0.4);
        }

        /* Jiffy.js Enhanced Animations */
        .jiffy-bounce {
            animation: jiffyBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes jiffyBounce {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.05) rotate(5deg); }
            70% { transform: scale(0.9) rotate(-2deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .jiffy-slide-up {
            animation: jiffySlideUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes jiffySlideUp {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .jiffy-fade-in {
            animation: jiffyFadeIn 1s ease-out;
        }

        @keyframes jiffyFadeIn {
            0% { opacity: 0; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }

        .jiffy-pulse {
            animation: jiffyPulse 2s infinite;
        }

        @keyframes jiffyPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .jiffy-hover-lift {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .jiffy-hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.2);
        }

        .jiffy-button-press {
            transition: all 0.1s ease;
        }

        .jiffy-button-press:active {
            transform: scale(0.95);
        }

        .jiffy-zoom-in {
            animation: jiffyZoomIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes jiffyZoomIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .jiffy-elastic {
            animation: jiffyElastic 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes jiffyElastic {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .jiffy-stagger-1 { animation-delay: 0.1s; }
        .jiffy-stagger-2 { animation-delay: 0.2s; }
        .jiffy-stagger-3 { animation-delay: 0.3s; }
        .jiffy-stagger-4 { animation-delay: 0.4s; }
        .jiffy-stagger-5 { animation-delay: 0.5s; }

        /* 3D Visualization Styles */
        #threejs-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .layer-tab {
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 12px 12px 0 0;
        }

        .layer-tab.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            transform: translateY(-2px);
        }

        .layer-tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }

        .visualization-mode-toggle {
            background: linear-gradient(135deg, #10b981, #059669);
            transition: all 0.3s ease;
        }

        .visualization-mode-toggle:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }

        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            background: rgba(255, 255, 255, 0.9);
        }

        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: rgba(255, 255, 255, 1);
        }

        .radio-card {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .radio-card:hover {
            border-color: #3b82f6;
            transform: scale(1.02);
        }

        .radio-card input:checked + .radio-content {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border-color: #3b82f6;
        }

        .metric-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(59, 130, 246, 0.1);
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.25);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(59, 130, 246, 0.2);
            border-left-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .jiffy-loading-dots {
            display: inline-flex;
            gap: 4px;
        }

        .jiffy-loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3b82f6;
            animation: jiffyLoadingDots 1.4s infinite ease-in-out;
        }

        .jiffy-loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .jiffy-loading-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes jiffyLoadingDots {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .jiffy-progress-bar {
            height: 6px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            border-radius: 3px;
            animation: jiffyProgressBar 2s ease-in-out;
            transform-origin: left;
        }

        @keyframes jiffyProgressBar {
            0% { transform: scaleX(0); }
            100% { transform: scaleX(1); }
        }

        .jiffy-success {
            animation: jiffySuccess 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes jiffySuccess {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(-90deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .section-header {
            position: relative;
            padding-left: 20px;
        }

        .section-header::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 2px;
        }

        .header-decoration {
            position: relative;
        }

        .header-decoration::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            border-radius: 2px;
        }

        /* Enhanced 3D Controls */
        .control-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #e2e8f0, #cbd5e1);
            outline: none;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .control-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        /* Professional Alert Styles */
        .jiffy-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .jiffy-alert.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .jiffy-alert.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .jiffy-alert.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .jiffy-alert.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
    </style>
</head>
<body>
    <div class="main-container container mx-auto px-4 py-8">
        <!-- Enhanced Header -->
        <div class="text-center mb-12 jiffy-bounce">
            <div class="header-decoration inline-block">
                <h1 class="text-5xl font-bold gradient-text mb-4">📦 Hitung Muat Kotak Kontainer 3D</h1>
            </div>
            <p class="text-xl text-white/80 font-medium jiffy-slide-up">Kalkulator otomatis dengan visualisasi 3D interaktif untuk optimasi penataan kotak</p>
            <div class="mt-6 flex justify-center space-x-4">
                <div class="glass-card px-4 py-2 rounded-full jiffy-fade-in jiffy-stagger-1">
                    <span class="text-sm font-medium text-gray-700">🎮 3D Interactive</span>
                </div>
                <div class="glass-card px-4 py-2 rounded-full jiffy-fade-in jiffy-stagger-2">
                    <span class="text-sm font-medium text-gray-700">📋 Multi-Layer</span>
                </div>
                <div class="glass-card px-4 py-2 rounded-full jiffy-fade-in jiffy-stagger-3">
                    <span class="text-sm font-medium text-gray-700">🎯 AI-Powered</span>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Input Panel -->
            <div class="glass-card rounded-2xl shadow-2xl p-8 jiffy-fade-in jiffy-stagger-1">
                <h2 class="section-header text-3xl font-bold text-gray-800 mb-8">⚙️ Pengaturan</h2>

                <!-- Container Size -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm mr-3 jiffy-pulse">📏</span>
                        Ukuran Kontainer (cm)
                    </h3>
                    <div class="glass-card p-4 rounded-xl mb-4 jiffy-hover-lift">
                        <div class="text-center">
                            <div class="text-2xl font-bold gradient-text">66.54 m³</div>
                            <div class="text-sm text-gray-600 font-medium">Volume Kontainer Total</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Panjang</label>
                            <input type="number" id="containerLength" value="1158" readonly
                                   class="input-field w-full px-4 py-3 rounded-xl font-medium text-center jiffy-hover-lift">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Lebar</label>
                            <input type="number" id="containerWidth" value="228" readonly
                                   class="input-field w-full px-4 py-3 rounded-xl font-medium text-center jiffy-hover-lift">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Tinggi</label>
                            <input type="number" id="containerHeight" value="252" readonly
                                   class="input-field w-full px-4 py-3 rounded-xl font-medium text-center jiffy-hover-lift">
                        </div>
                    </div>
                </div>

                <!-- Box Size -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white text-sm mr-3 jiffy-pulse">📦</span>
                        Ukuran Kotak (cm)
                    </h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Panjang</label>
                            <input type="number" id="boxLength" value="60" 
                                   class="input-field w-full px-4 py-3 rounded-xl font-medium text-center jiffy-hover-lift">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Lebar</label>
                            <input type="number" id="boxWidth" value="40" 
                                   class="input-field w-full px-4 py-3 rounded-xl font-medium text-center jiffy-hover-lift">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Tinggi</label>
                            <input type="number" id="boxHeight" value="30" 
                                   class="input-field w-full px-4 py-3 rounded-xl font-medium text-center jiffy-hover-lift">
                        </div>
                    </div>
                </div>

                <!-- Layout Pattern -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-sm mr-3 jiffy-pulse">🎯</span>
                        Pola Penataan
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="radio-card border-2 rounded-xl p-4 jiffy-hover-lift">
                            <input type="radio" name="layoutPattern" value="normal" checked class="sr-only">
                            <div class="radio-content text-center">
                                <div class="text-2xl mb-2">□</div>
                                <div class="font-semibold text-gray-700">Normal</div>
                                <div class="text-xs text-gray-500">Penataan standar</div>
                            </div>
                        </label>
                        <label class="radio-card border-2 rounded-xl p-4 jiffy-hover-lift">
                            <input type="radio" name="layoutPattern" value="zigzag" class="sr-only">
                            <div class="radio-content text-center">
                                <div class="text-2xl mb-2">⟲</div>
                                <div class="font-semibold text-gray-700">Zig-Zag</div>
                                <div class="text-xs text-gray-500">Pola bergantian</div>
                            </div>
                        </label>
                        <label class="radio-card border-2 rounded-xl p-4 jiffy-hover-lift">
                            <input type="radio" name="layoutPattern" value="offset" class="sr-only">
                            <div class="radio-content text-center">
                                <div class="text-2xl mb-2">⬢</div>
                                <div class="font-semibold text-gray-700">Offset</div>
                                <div class="text-xs text-gray-500">Pola bergeser</div>
                            </div>
                        </label>
                        <label class="radio-card border-2 rounded-xl p-4 jiffy-hover-lift">
                            <input type="radio" name="layoutPattern" value="optimal" class="sr-only">
                            <div class="radio-content text-center">
                                <div class="text-2xl mb-2">🎯</div>
                                <div class="font-semibold text-gray-700">Optimal</div>
                                <div class="text-xs text-gray-500">AI terbaik</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Additional Options -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                        <span class="w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center text-white text-sm mr-3 jiffy-pulse">🔧</span>
                        Opsi Tambahan
                    </h3>
                    <div class="space-y-4">
                        <label class="flex items-center p-4 glass-card rounded-xl cursor-pointer jiffy-hover-lift transition-all">
                            <input type="checkbox" id="allowRotation" checked 
                                   class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <div class="ml-4">
                                <div class="font-semibold text-gray-700">Izinkan rotasi kotak (90°)</div>
                                <div class="text-sm text-gray-500">Meningkatkan efisiensi penataan</div>
                            </div>
                        </label>
                        <label class="flex items-center p-4 glass-card rounded-xl cursor-pointer jiffy-hover-lift transition-all">
                            <input type="checkbox" id="enable3D" 
                                   class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <div class="ml-4">
                                <div class="font-semibold text-gray-700">Mode Visualisasi 3D</div>
                                <div class="text-sm text-gray-500">Tampilan interaktif dengan kontrol kamera</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-4">
                    <button onclick="calculateOptimalLayout()" 
                            class="gradient-button w-full text-white font-bold py-4 px-8 rounded-xl shadow-lg text-lg jiffy-button-press jiffy-hover-lift">
                        🧮 Hitung Layout Optimal
                    </button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="glass-card rounded-2xl shadow-2xl p-8 jiffy-fade-in jiffy-stagger-2">
                <h2 class="section-header text-3xl font-bold text-gray-800 mb-8">📊 Hasil Perhitungan</h2>

                <div id="resultsContainer" class="space-y-6">
                    <div class="text-center text-gray-500 py-12">
                        <div class="text-8xl mb-6 jiffy-pulse">📦</div>
                        <p class="text-lg font-medium jiffy-fade-in">Masukkan ukuran dan klik "Hitung Layout Optimal" untuk melihat hasil</p>
                        <div class="mt-4 text-sm text-gray-400 jiffy-fade-in jiffy-stagger-1">Sistem AI siap menganalisis konfigurasi optimal Anda</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Visualization Panel -->
        <div class="mt-12 glass-card rounded-2xl shadow-2xl p-8 jiffy-fade-in jiffy-stagger-3">
            <div class="flex justify-between items-center mb-8">
                <h2 class="section-header text-3xl font-bold text-gray-800">🎯 Visualisasi Layout 3D</h2>
                <div class="flex gap-3">
                    <button id="toggle3DMode" onclick="toggle3DVisualization()" 
                            class="visualization-mode-toggle text-white px-6 py-3 rounded-xl font-semibold jiffy-button-press jiffy-hover-lift">
                        🎮 Mode 3D
                    </button>
                    <button onclick="exportToPDF()" 
                            class="bg-gradient-to-r from-red-500 to-pink-500 text-white px-6 py-3 rounded-xl hover:from-red-600 hover:to-pink-600 transition-all duration-300 shadow-lg jiffy-button-press jiffy-hover-lift font-semibold">
                        📄 Export PDF
                    </button>
                </div>
            </div>

            <!-- Layer Controls -->
            <div id="layerControls" class="hidden mb-6 control-panel p-6 rounded-xl jiffy-elastic">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-bold text-gray-700">🏗️ Kontrol Layer (Tinggi)</h4>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="showAllLayers" onchange="toggleLayerMode()" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">Tampilkan Semua Layer</span>
                        </label>
                    </div>
                </div>
                <div class="text-xs text-gray-500 bg-blue-50 p-2 rounded-lg mb-4">
                    💡 <strong>Layer:</strong> Lapisan kotak dari bawah ke atas (berdasarkan tinggi kontainer)
                </div>
                
                <!-- Layer Tabs -->
                <div id="layerTabs" class="flex gap-2 mb-4 overflow-x-auto"></div>
                
                <!-- Layer Slider -->
                <div class="flex items-center gap-6">
                    <label class="text-sm font-semibold text-gray-700 min-w-16">Layer:</label>
                    <input type="range" id="layerSlider" min="1" max="1" value="1" 
                           class="control-slider flex-1" onchange="showSpecificLayer(this.value)">
                    <span id="layerDisplay" class="text-sm font-bold text-gray-700 min-w-16 text-center">1 / 1</span>
                </div>
            </div>

            <!-- 3D Controls Panel -->
            <div id="threeDControls" class="hidden mb-6 control-panel p-6 rounded-xl jiffy-zoom-in">
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h4 class="text-lg font-bold text-gray-700 flex items-center">
                            <span class="w-6 h-6 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-xs mr-2">🎮</span>
                            Kontrol Kamera
                        </h4>
                        <div class="space-y-3">
                            <button onclick="resetCamera()" 
                                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all jiffy-button-press">
                                🔄 Reset View
                            </button>
                            <div class="flex items-center gap-3">
                                <label class="text-sm font-medium text-gray-700 min-w-20">Wireframe:</label>
                                <input type="checkbox" id="wireframeMode" onchange="toggleWireframe()" 
                                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <h4 class="text-lg font-bold text-gray-700 flex items-center">
                            <span class="w-6 h-6 bg-gradient-to-r from-green-500 to-teal-500 rounded-full flex items-center justify-center text-white text-xs mr-2">🎨</span>
                            Visual Settings
                        </h4>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <label class="text-sm font-medium text-gray-700 min-w-20">Opacity:</label>
                                <input type="range" id="opacitySlider" min="0.1" max="1" step="0.1" value="0.8" 
                                       class="control-slider flex-1" onchange="updateOpacity(this.value)">
                                <span id="opacityValue" class="text-sm font-bold text-gray-700 min-w-8">0.8</span>
                            </div>
                            <div class="text-xs text-gray-500 bg-gray-100 p-2 rounded-lg">
                                💡 <strong>Tips:</strong> Drag untuk memutar, scroll untuk zoom, klik kanan untuk pan
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualization Container -->
            <div id="visualizationContainer" class="border-4 border-gray-200 rounded-2xl p-8 min-h-96 flex items-center justify-center bg-gradient-to-br from-gray-50 to-white jiffy-hover-lift">
                <div class="text-center text-gray-500">
                    <div class="text-8xl mb-6 jiffy-pulse">🎨</div>
                    <p class="text-xl font-medium jiffy-fade-in">Visualisasi akan muncul setelah perhitungan</p>
                    <div class="mt-4 text-sm text-gray-400 jiffy-fade-in jiffy-stagger-1">Sistem akan menampilkan layout 2D/3D interaktif</div>
                </div>
            </div>

            <!-- 3D Container -->
            <div id="threejs-container" class="hidden rounded-2xl overflow-hidden"></div>
        </div>
    </div>

    <script>
        let calculationResults = null;
        let currentVisualizationMode = '2d';
        let scene, camera, renderer, controls;
        let boxMeshes = [];
        let containerMesh = null;
        let animationId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeJiffyAnimations();
            setupEventListeners();
        });

        function initializeJiffyAnimations() {
            // Add entrance animations to cards
            const cards = document.querySelectorAll('.glass-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('jiffy-fade-in');
                }, index * 100);
            });

            // Add hover effects to interactive elements
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.classList.add('jiffy-hover-lift');
                });
                
                button.addEventListener('mouseleave', function() {
                    this.classList.remove('jiffy-hover-lift');
                });
            });

            // Add input field animations
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.classList.add('jiffy-zoom-in');
                });
                
                input.addEventListener('blur', function() {
                    this.classList.remove('jiffy-zoom-in');
                });
            });
        }

        function setupEventListeners() {
            // Radio button change listeners
            const radioButtons = document.querySelectorAll('input[name="layoutPattern"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    this.closest('.radio-card').classList.add('jiffy-bounce');
                    setTimeout(() => {
                        this.closest('.radio-card').classList.remove('jiffy-bounce');
                    }, 600);
                });
            });

            // Checkbox listeners
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    this.closest('label').classList.add('jiffy-pulse');
                    setTimeout(() => {
                        this.closest('label').classList.remove('jiffy-pulse');
                    }, 2000);
                });
            });
        }

        function showJiffyAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `jiffy-alert ${type} jiffy-bounce`;
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            alert.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-xl">${icons[type]}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.classList.add('jiffy-fade-out');
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }, 3000);
        }

        function calculateOptimalLayout() {
            const button = event.target;
            button.classList.add('jiffy-pulse');
            setTimeout(() => button.classList.remove('jiffy-pulse'), 2000);

            // Get input values
            const containerL = parseFloat(document.getElementById('containerLength').value);
            const containerW = parseFloat(document.getElementById('containerWidth').value);
            const containerH = parseFloat(document.getElementById('containerHeight').value);
            
            const boxL = parseFloat(document.getElementById('boxLength').value);
            const boxW = parseFloat(document.getElementById('boxWidth').value);
            const boxH = parseFloat(document.getElementById('boxHeight').value);
            
            const allowRotation = document.getElementById('allowRotation').checked;
            const selectedPattern = document.querySelector('input[name="layoutPattern"]:checked').value;

            // Validate inputs
            if (!boxL || !boxW || !boxH || boxL <= 0 || boxW <= 0 || boxH <= 0) {
                showJiffyAlert('Mohon isi semua ukuran kotak dengan benar!', 'error');
                return;
            }

            if (boxL > containerL || boxW > containerW || boxH > containerH) {
                showJiffyAlert('Ukuran kotak tidak boleh lebih besar dari kontainer!', 'error');
                return;
            }

            // Show loading state
            document.getElementById('resultsContainer').innerHTML = `
                <div class="text-center py-12 jiffy-fade-in">
                    <div class="loading-spinner mx-auto mb-6"></div>
                    <p class="text-xl font-semibold text-gray-700 mb-2 jiffy-slide-up">Menghitung layout ${selectedPattern}...</p>
                    <div class="w-64 mx-auto bg-gray-200 rounded-full h-2 mb-4">
                        <div class="jiffy-progress-bar h-2 rounded-full"></div>
                    </div>
                    <p class="text-sm text-gray-500 jiffy-fade-in jiffy-stagger-1">AI sedang menganalisis konfigurasi optimal</p>
                    <div class="jiffy-loading-dots mt-4">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;

            // Calculate scenarios
            setTimeout(() => {
                const scenarios = [];
                let optimal;

                if (selectedPattern === 'optimal') {
                    const normal = calculateScenario(containerL, containerW, containerH, boxL, boxW, boxH, 'Normal', false);
                    scenarios.push(normal);

                    if (allowRotation) {
                        const rotated = calculateScenario(containerL, containerW, containerH, boxW, boxL, boxH, 'Rotasi 90°', true);
                        scenarios.push(rotated);
                        
                        const mixed = calculateMixedLayout(containerL, containerW, containerH, boxL, boxW, boxH);
                        scenarios.push(mixed);
                    }

                    optimal = scenarios.reduce((best, current) => 
                        current.totalBoxes > best.totalBoxes ? current : best
                    );
                } else {
                    switch (selectedPattern) {
                        case 'normal':
                            optimal = calculateScenario(containerL, containerW, containerH, boxL, boxW, boxH, 'Normal', false);
                            break;
                        case 'zigzag':
                            optimal = calculateZigZagLayout(containerL, containerW, containerH, boxL, boxW, boxH);
                            break;
                        case 'offset':
                            optimal = calculateOffsetLayout(containerL, containerW, containerH, boxL, boxW, boxH);
                            break;
                    }
                    scenarios.push(optimal);
                }

                // Calculate metrics
                const containerVolume = containerL * containerW * containerH;
                const boxVolume = boxL * boxW * boxH;
                const wastedSpace = containerVolume - (optimal.totalBoxes * boxVolume);

                calculationResults = {
                    scenarios: scenarios,
                    optimal: optimal,
                    containerDimensions: { length: containerL, width: containerW, height: containerH },
                    boxDimensions: { length: boxL, width: boxW, height: boxH },
                    metrics: {
                        containerVolume: containerVolume,
                        boxVolume: boxVolume,
                        wastedSpace: wastedSpace,
                        spaceSavings: ((optimal.totalBoxes * boxVolume) / containerVolume * 100).toFixed(1)
                    }
                };

                displayResults();
                createVisualization();
                showJiffyAlert('Perhitungan selesai! 🎉', 'success');
            }, 2000);
        }

        function calculateScenario(containerL, containerW, containerH, boxL, boxW, boxH, name, isRotated = false) {
            const boxesPerRow = Math.floor(containerL / boxL);
            const boxesPerCol = Math.floor(containerW / boxW);
            const boxesPerLayer = boxesPerRow * boxesPerCol;
            const layers = Math.floor(containerH / boxH);
            const totalBoxes = boxesPerLayer * layers;
            
            const usedVolume = totalBoxes * (boxL * boxW * boxH);
            const containerVolume = containerL * containerW * containerH;
            const efficiency = (usedVolume / containerVolume) * 100;

            return {
                name: name,
                boxesPerRow: boxesPerRow,
                boxesPerCol: boxesPerCol,
                boxesPerLayer: boxesPerLayer,
                layers: layers,
                totalBoxes: totalBoxes,
                efficiency: efficiency.toFixed(1),
                layout: generateLayoutPattern(boxesPerRow, boxesPerCol, layers, isRotated)
            };
        }

        function calculateMixedLayout(containerL, containerW, containerH, boxL, boxW, boxH) {
            let bestResult = { totalBoxes: 0 };
            
            const normalPerRow = Math.floor(containerL / boxL);
            const normalPerCol = Math.floor(containerW / boxW);
            const rotatedPerRow = Math.floor(containerL / boxW);
            const rotatedPerCol = Math.floor(containerW / boxL);
            
            for (let normalRows = 0; normalRows <= normalPerCol; normalRows++) {
                const remainingWidth = containerW - (normalRows * boxW);
                const rotatedRows = Math.floor(remainingWidth / boxL);
                
                const totalBoxesPerLayer = (normalRows * normalPerRow) + (rotatedRows * rotatedPerRow);
                const layers = Math.floor(containerH / boxH);
                const totalBoxes = totalBoxesPerLayer * layers;
                
                if (totalBoxes > bestResult.totalBoxes) {
                    const usedVolume = totalBoxes * (boxL * boxW * boxH);
                    const containerVolume = containerL * containerW * containerH;
                    const efficiency = (usedVolume / containerVolume) * 100;
                    
                    bestResult = {
                        name: 'Kombinasi Optimal',
                        boxesPerRow: Math.max(normalPerRow, rotatedPerRow),
                        boxesPerCol: normalRows + rotatedRows,
                        boxesPerLayer: totalBoxesPerLayer,
                        layers: layers,
                        totalBoxes: totalBoxes,
                        efficiency: efficiency.toFixed(1),
                        layout: generateMixedLayoutPattern(normalPerRow, rotatedPerRow, normalRows, rotatedRows, layers)
                    };
                }
            }
            
            return bestResult;
        }

        function calculateZigZagLayout(containerL, containerW, containerH, boxL, boxW, boxH) {
            const normalPerRow = Math.floor(containerL / boxL);
            const rotatedPerRow = Math.floor(containerL / boxW);
            
            let totalRows = 0;
            let currentWidth = 0;
            let alternateNormal = true;
            
            while (currentWidth < containerW) {
                const nextRowWidth = alternateNormal ? boxW : boxL;
                if (currentWidth + nextRowWidth <= containerW) {
                    currentWidth += nextRowWidth;
                    totalRows++;
                    alternateNormal = !alternateNormal;
                } else {
                    break;
                }
            }
            
            const normalRowCount = Math.ceil(totalRows / 2);
            const rotatedRowCount = Math.floor(totalRows / 2);
            const boxesPerLayer = (normalRowCount * normalPerRow) + (rotatedRowCount * rotatedPerRow);
            const layers = Math.floor(containerH / boxH);
            const totalBoxes = boxesPerLayer * layers;
            
            const usedVolume = totalBoxes * (boxL * boxW * boxH);
            const containerVolume = containerL * containerW * containerH;
            const efficiency = (usedVolume / containerVolume) * 100;
            
            return {
                name: 'Pola Zig-Zag',
                boxesPerRow: Math.max(normalPerRow, rotatedPerRow),
                boxesPerCol: totalRows,
                boxesPerLayer: boxesPerLayer,
                layers: layers,
                totalBoxes: totalBoxes,
                efficiency: efficiency.toFixed(1),
                layout: generateZigZagLayoutPattern(normalPerRow, rotatedPerRow, normalRowCount, rotatedRowCount, layers)
            };
        }

        function calculateOffsetLayout(containerL, containerW, containerH, boxL, boxW, boxH) {
            const boxesPerRow = Math.floor(containerL / boxL);
            const boxesPerCol = Math.floor(containerW / boxW);
            
            const offsetShift = boxL / 2;
            const offsetBoxesPerRow = Math.floor((containerL - offsetShift) / boxL);
            
            const fullRows = Math.ceil(boxesPerCol / 2);
            const offsetRows = Math.floor(boxesPerCol / 2);
            
            const boxesPerLayer = (fullRows * boxesPerRow) + (offsetRows * offsetBoxesPerRow);
            const layers = Math.floor(containerH / boxH);
            const totalBoxes = boxesPerLayer * layers;
            
            const usedVolume = totalBoxes * (boxL * boxW * boxH);
            const containerVolume = containerL * containerW * containerH;
            const efficiency = (usedVolume / containerVolume) * 100;
            
            return {
                name: 'Pola Offset',
                boxesPerRow: boxesPerRow,
                boxesPerCol: boxesPerCol,
                boxesPerLayer: boxesPerLayer,
                layers: layers,
                totalBoxes: totalBoxes,
                efficiency: efficiency.toFixed(1),
                layout: generateOffsetLayoutPattern(boxesPerRow, offsetBoxesPerRow, fullRows, offsetRows, layers)
            };
        }

        function generateLayoutPattern(boxesPerRow, boxesPerCol, layers, isRotated) {
            const pattern = [];
            for (let layer = 0; layer < layers; layer++) {
                const layerPattern = [];
                for (let col = 0; col < boxesPerCol; col++) {
                    const row = [];
                    for (let r = 0; r < boxesPerRow; r++) {
                        row.push({ rotated: isRotated, type: isRotated ? 'rotated' : 'normal' });
                    }
                    layerPattern.push(row);
                }
                pattern.push(layerPattern);
            }
            return pattern;
        }

        function generateMixedLayoutPattern(normalPerRow, rotatedPerRow, normalRows, rotatedRows, layers) {
            const pattern = [];
            for (let layer = 0; layer < layers; layer++) {
                const layerPattern = [];
                
                for (let col = 0; col < normalRows; col++) {
                    const row = [];
                    for (let r = 0; r < normalPerRow; r++) {
                        row.push({ rotated: false, type: 'normal' });
                    }
                    layerPattern.push(row);
                }
                
                for (let col = 0; col < rotatedRows; col++) {
                    const row = [];
                    for (let r = 0; r < rotatedPerRow; r++) {
                        row.push({ rotated: true, type: 'rotated' });
                    }
                    layerPattern.push(row);
                }
                
                pattern.push(layerPattern);
            }
            return pattern;
        }

        function generateZigZagLayoutPattern(normalPerRow, rotatedPerRow, normalRowCount, rotatedRowCount, layers) {
            const pattern = [];
            for (let layer = 0; layer < layers; layer++) {
                const layerPattern = [];
                let isNormalRow = true;
                
                for (let row = 0; row < (normalRowCount + rotatedRowCount); row++) {
                    const rowPattern = [];
                    const boxesInThisRow = isNormalRow ? normalPerRow : rotatedPerRow;
                    
                    for (let col = 0; col < boxesInThisRow; col++) {
                        rowPattern.push({ 
                            rotated: !isNormalRow, 
                            type: isNormalRow ? 'normal' : 'rotated',
                            zigzag: true 
                        });
                    }
                    
                    layerPattern.push(rowPattern);
                    isNormalRow = !isNormalRow;
                }
                
                pattern.push(layerPattern);
            }
            return pattern;
        }

        function generateOffsetLayoutPattern(boxesPerRow, offsetBoxesPerRow, fullRows, offsetRows, layers) {
            const pattern = [];
            for (let layer = 0; layer < layers; layer++) {
                const layerPattern = [];
                let isFullRow = true;
                
                for (let row = 0; row < (fullRows + offsetRows); row++) {
                    const rowPattern = [];
                    const boxesInThisRow = isFullRow ? boxesPerRow : offsetBoxesPerRow;
                    
                    for (let col = 0; col < boxesInThisRow; col++) {
                        rowPattern.push({ 
                            rotated: false, 
                            type: 'normal',
                            offset: !isFullRow,
                            offsetShift: !isFullRow ? 0.5 : 0
                        });
                    }
                    
                    layerPattern.push(rowPattern);
                    isFullRow = !isFullRow;
                }
                
                pattern.push(layerPattern);
            }
            return pattern;
        }

        function displayResults() {
            const container = document.getElementById('resultsContainer');
            const { scenarios, optimal, metrics } = calculationResults;
            
            let html = `
                <div class="p-6 rounded-2xl border-l-4 border-green-500 mb-8 jiffy-success" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1));">
                    <h3 class="text-2xl font-bold text-green-800 mb-4 flex items-center">
                        <span class="w-10 h-10 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white mr-3 jiffy-pulse">🏆</span>
                        Layout Optimal: ${optimal.name}
                    </h3>
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div class="text-center jiffy-bounce jiffy-stagger-1">
                            <div class="text-4xl font-bold gradient-text">${optimal.totalBoxes}</div>
                            <div class="text-sm font-semibold text-gray-600">Total Kotak</div>
                        </div>
                        <div class="text-center jiffy-bounce jiffy-stagger-2">
                            <div class="text-4xl font-bold gradient-text">${optimal.efficiency}%</div>
                            <div class="text-sm font-semibold text-gray-600">Efisiensi</div>
                        </div>
                        <div class="text-center jiffy-bounce jiffy-stagger-3">
                            <div class="text-2xl font-bold text-gray-700">${optimal.boxesPerLayer}</div>
                            <div class="text-sm font-semibold text-gray-600">Kotak per Lapisan</div>
                        </div>
                        <div class="text-center jiffy-bounce jiffy-stagger-4">
                            <div class="text-2xl font-bold text-gray-700">${optimal.layers}</div>
                            <div class="text-sm font-semibold text-gray-600">Lapisan Tinggi</div>
                        </div>
                    </div>
                </div>

                <div class="p-6 rounded-2xl mb-8 jiffy-slide-up" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));">
                    <h4 class="text-2xl font-bold text-blue-800 mb-6 flex items-center">
                        <span class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white mr-3 jiffy-pulse">📊</span>
                        Analisis Mendalam
                    </h4>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="metric-card p-4 rounded-xl jiffy-hover-lift jiffy-fade-in jiffy-stagger-1">
                            <div class="text-gray-600 font-semibold mb-1">Volume Kontainer</div>
                            <div class="text-2xl font-bold gradient-text">${(metrics.containerVolume / 1000000).toFixed(2)} m³</div>
                        </div>
                        <div class="metric-card p-4 rounded-xl jiffy-hover-lift jiffy-fade-in jiffy-stagger-2">
                            <div class="text-gray-600 font-semibold mb-1">Volume Terpakai</div>
                            <div class="text-2xl font-bold text-green-600">${metrics.spaceSavings}%</div>
                        </div>
                        <div class="metric-card p-4 rounded-xl jiffy-hover-lift jiffy-fade-in jiffy-stagger-3">
                            <div class="text-gray-600 font-semibold mb-1">Ruang Terbuang</div>
                            <div class="text-2xl font-bold text-red-600">${(metrics.wastedSpace / 1000000).toFixed(2)} m³</div>
                        </div>
                        <div class="metric-card p-4 rounded-xl jiffy-hover-lift jiffy-fade-in jiffy-stagger-4">
                            <div class="text-gray-600 font-semibold mb-1">Kotak per m³</div>
                            <div class="text-2xl font-bold text-purple-600">${(optimal.totalBoxes / (metrics.containerVolume / 1000000)).toFixed(0)}</div>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4 jiffy-slide-up">
                    <h4 class="text-xl font-bold text-gray-700 flex items-center">
                        <span class="w-8 h-8 bg-gradient-to-r from-gray-500 to-gray-700 rounded-full flex items-center justify-center text-white text-sm mr-3 jiffy-pulse">📋</span>
                        Perbandingan Semua Skenario
                    </h4>
            `;
            
            scenarios.forEach((scenario, index) => {
                const isOptimal = scenario === optimal;
                html += `
                    <div class="p-4 rounded-xl border-2 ${isOptimal ? 'border-green-300' : 'border-gray-200'} jiffy-fade-in jiffy-stagger-${index + 1} jiffy-hover-lift" style="background: ${isOptimal ? 'linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(59, 130, 246, 0.05))' : 'rgba(255, 255, 255, 0.8)'};">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-lg font-bold ${isOptimal ? 'text-green-800' : 'text-gray-700'}">${scenario.name}</span>
                            ${isOptimal ? '<span class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-3 py-1 rounded-full text-xs font-bold jiffy-bounce">OPTIMAL ✨</span>' : ''}
                        </div>
                        <div class="grid grid-cols-4 gap-4 text-sm">
                            <div class="text-center">
                                <div class="font-bold text-xl ${isOptimal ? 'text-green-600' : 'text-gray-700'}">${scenario.totalBoxes}</div>
                                <div class="text-gray-600">Total</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-gray-700">${scenario.boxesPerLayer}</div>
                                <div class="text-gray-600">Per Lapisan</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-gray-700">${scenario.layers}</div>
                                <div class="text-gray-600">Lapisan Tinggi</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg ${isOptimal ? 'text-blue-600' : 'text-gray-700'}">${scenario.efficiency}%</div>
                                <div class="text-gray-600">Efisiensi</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function createVisualization() {
            const enable3D = document.getElementById('enable3D').checked;
            
            if (enable3D) {
                currentVisualizationMode = '3d';
                document.getElementById('toggle3DMode').textContent = '📋 Mode 2D';
                document.getElementById('threeDControls').classList.remove('hidden');
                document.getElementById('threeDControls').classList.add('jiffy-zoom-in');
                init3DVisualization();
            } else {
                currentVisualizationMode = '2d';
                document.getElementById('toggle3DMode').textContent = '🎮 Mode 3D';
                document.getElementById('threeDControls').classList.add('hidden');
                create2DVisualization();
            }
            
            setupLayerControls();
        }

        function toggle3DVisualization() {
            if (currentVisualizationMode === '2d') {
                currentVisualizationMode = '3d';
                document.getElementById('toggle3DMode').textContent = '📋 Mode 2D';
                document.getElementById('toggle3DMode').classList.add('jiffy-bounce');
                setTimeout(() => document.getElementById('toggle3DMode').classList.remove('jiffy-bounce'), 600);
                
                if (calculationResults) {
                    document.getElementById('threeDControls').classList.remove('hidden');
                    document.getElementById('threeDControls').classList.add('jiffy-zoom-in');
                    init3DVisualization();
                }
            } else {
                currentVisualizationMode = '2d';
                document.getElementById('toggle3DMode').textContent = '🎮 Mode 3D';
                document.getElementById('toggle3DMode').classList.add('jiffy-bounce');
                setTimeout(() => document.getElementById('toggle3DMode').classList.remove('jiffy-bounce'), 600);
                
                document.getElementById('threeDControls').classList.add('hidden');
                cleanup3D();
                if (calculationResults) {
                    create2DVisualization();
                }
            }
        }

        function init3DVisualization() {
            if (!calculationResults) return;

            cleanup3D();

            const container = document.getElementById('visualizationContainer');
            container.style.display = 'none';
            
            const threejsContainer = document.getElementById('threejs-container');
            threejsContainer.style.display = 'block';
            threejsContainer.classList.add('jiffy-zoom-in');
            
            // Setup Three.js scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf8fafc);

            // Camera
            camera = new THREE.PerspectiveCamera(75, threejsContainer.clientWidth / 600, 0.1, 1000);
            camera.position.set(50, 50, 50);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(threejsContainer.clientWidth, 600);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            threejsContainer.appendChild(renderer.domElement);

            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 25);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);

            // Create container wireframe
            createContainer3D();
            
            // Create boxes
            createBoxes3D();

            // Start animation loop
            animate3D();
        }

        function createContainer3D() {
            const { containerDimensions } = calculationResults;
            const geometry = new THREE.BoxGeometry(
                containerDimensions.length / 10,
                containerDimensions.height / 10,
                containerDimensions.width / 10
            );
            
            const edges = new THREE.EdgesGeometry(geometry);
            const material = new THREE.LineBasicMaterial({ color: 0x3b82f6, linewidth: 3 });
            containerMesh = new THREE.LineSegments(edges, material);
            
            containerMesh.position.set(
                containerDimensions.length / 20,
                containerDimensions.height / 20,
                containerDimensions.width / 20
            );
            
            scene.add(containerMesh);
        }

        function createBoxes3D() {
            const { optimal, boxDimensions } = calculationResults;
            const showAllLayers = document.getElementById('showAllLayers').checked;
            const currentLayer = parseInt(document.getElementById('layerSlider').value) - 1;
            
            boxMeshes.forEach(mesh => scene.remove(mesh));
            boxMeshes = [];

            const layersToShow = showAllLayers ? optimal.layers : 1;
            const startLayer = showAllLayers ? 0 : currentLayer;
            const endLayer = showAllLayers ? optimal.layers : currentLayer + 1;

            for (let layerIndex = startLayer; layerIndex < endLayer && layerIndex < optimal.layout.length; layerIndex++) {
                const layer = optimal.layout[layerIndex];
                
                layer.forEach((row, rowIndex) => {
                    row.forEach((box, colIndex) => {
                        const boxGeometry = new THREE.BoxGeometry(
                            (box.rotated ? boxDimensions.width : boxDimensions.length) / 10,
                            boxDimensions.height / 10,
                            (box.rotated ? boxDimensions.length : boxDimensions.width) / 10
                        );

                        let color = 0x60a5fa; // Normal blue
                        if (box.rotated) color = 0xf87171; // Rotated red
                        if (box.zigzag) color = 0xa78bfa; // Zigzag purple
                        if (box.offset) color = 0x34d399; // Offset green

                        const boxMaterial = new THREE.MeshLambertMaterial({ 
                            color: color,
                            transparent: true,
                            opacity: 0.8
                        });

                        const boxMesh = new THREE.Mesh(boxGeometry, boxMaterial);
                        
                        // Position calculation
                        const boxWidth = (box.rotated ? boxDimensions.width : boxDimensions.length) / 10;
                        const boxDepth = (box.rotated ? boxDimensions.length : boxDimensions.width) / 10;
                        
                        let offsetX = 0;
                        if (box.offset && box.offsetShift) {
                            offsetX = boxWidth * box.offsetShift;
                        }

                        boxMesh.position.set(
                            (colIndex * boxWidth) + (boxWidth / 2) + offsetX,
                            (layerIndex * boxDimensions.height / 10) + (boxDimensions.height / 20),
                            (rowIndex * boxDepth) + (boxDepth / 2)
                        );

                        boxMesh.castShadow = true;
                        boxMesh.receiveShadow = true;
                        
                        scene.add(boxMesh);
                        boxMeshes.push(boxMesh);
                    });
                });
            }
        }

        function animate3D() {
            if (currentVisualizationMode !== '3d') return;
            
            animationId = requestAnimationFrame(animate3D);
            controls.update();
            renderer.render(scene, camera);
        }

        function cleanup3D() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (renderer) {
                const threejsContainer = document.getElementById('threejs-container');
                if (threejsContainer.contains(renderer.domElement)) {
                    threejsContainer.removeChild(renderer.domElement);
                }
                renderer.dispose();
                renderer = null;
            }
            
            if (scene) {
                boxMeshes.forEach(mesh => scene.remove(mesh));
                boxMeshes = [];
                if (containerMesh) {
                    scene.remove(containerMesh);
                    containerMesh = null;
                }
                scene = null;
            }
            
            camera = null;
            controls = null;
            
            document.getElementById('threejs-container').style.display = 'none';
            document.getElementById('visualizationContainer').style.display = 'flex';
        }

        function create2DVisualization() {
            const container = document.getElementById('visualizationContainer');
            const { optimal, containerDimensions, boxDimensions } = calculationResults;
            
            // Create 2D SVG visualization
            const svgWidth = 800;
            const svgHeight = 500;
            const scale = Math.min(600 / containerDimensions.length, 300 / containerDimensions.width);
            const containerWidth = containerDimensions.length * scale;
            const containerHeight = containerDimensions.width * scale;
            
            const showAllLayers = document.getElementById('showAllLayers').checked;
            const currentLayer = parseInt(document.getElementById('layerSlider').value) - 1;
            
            let html = `
                <div class="w-full jiffy-zoom-in" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 20px; padding: 30px;">
                    <svg width="${svgWidth}" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}" class="mx-auto">
                        <defs>
                            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e2e8f0" stroke-width="0.5" opacity="0.5"/>
                            </pattern>
                            <filter id="boxShadow" x="-50%" y="-50%" width="200%" height="200%">
                                <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#000000" flood-opacity="0.2"/>
                            </filter>
                        </defs>
                        
                        <rect width="100%" height="100%" fill="url(#grid)" />
                        
                        <g transform="translate(${(svgWidth - containerWidth) / 2}, ${(svgHeight - containerHeight) / 2})">
                            <rect x="0" y="0" width="${containerWidth}" height="${containerHeight}" 
                                  fill="none" stroke="#3b82f6" stroke-width="3" rx="8" stroke-dasharray="10,5"/>
                            
                            <text x="${containerWidth/2}" y="-15" text-anchor="middle" 
                                  class="text-lg font-bold fill-blue-700" style="font-family: 'Inter', sans-serif;">
                                Kontainer ${containerDimensions.length}×${containerDimensions.width}×${containerDimensions.height} cm (Tampak Atas)
                            </text>
            `;
            
            // Add boxes for current layer(s)
            const layersToShow = showAllLayers ? optimal.layers : 1;
            const startLayer = showAllLayers ? 0 : currentLayer;
            const endLayer = showAllLayers ? optimal.layers : currentLayer + 1;

            for (let layerIndex = startLayer; layerIndex < endLayer && layerIndex < optimal.layout.length; layerIndex++) {
                const layer = optimal.layout[layerIndex];
                const opacity = showAllLayers ? Math.max(0.6, 1 - (layerIndex * 0.15)) : 1;
                
                let currentTop = 0;
                
                layer.forEach((row, rowIndex) => {
                    let currentLeft = 0;
                    let maxRowHeight = 0;
                    
                    row.forEach((box, colIndex) => {
                        const boxWidth = (box.rotated ? boxDimensions.width : boxDimensions.length) * scale;
                        const boxHeight = (box.rotated ? boxDimensions.length : boxDimensions.width) * scale;
                        
                        maxRowHeight = Math.max(maxRowHeight, boxHeight);
                        
                        let fillColor = '#60a5fa';
                        let strokeColor = '#3b82f6';
                        if (box.rotated) {
                            fillColor = '#f87171';
                            strokeColor = '#ef4444';
                        } else if (box.zigzag) {
                            fillColor = '#a78bfa';
                            strokeColor = '#8b5cf6';
                        } else if (box.offset) {
                            fillColor = '#34d399';
                            strokeColor = '#10b981';
                        }
                        
                        let offsetLeft = currentLeft;
                        if (box.offset && box.offsetShift) {
                            offsetLeft += boxWidth * box.offsetShift;
                        }
                        
                        html += `
                            <g class="box-group" style="cursor: pointer;">
                                <rect x="${offsetLeft + 2}" y="${currentTop + 2}" 
                                      width="${boxWidth}" height="${boxHeight}" 
                                      fill="#000000" opacity="0.1" rx="4" />
                                
                                <rect x="${offsetLeft}" y="${currentTop}" 
                                      width="${boxWidth}" height="${boxHeight}" 
                                      fill="${fillColor}" stroke="${strokeColor}" stroke-width="2" 
                                      rx="4" opacity="${opacity}" filter="url(#boxShadow)" />
                                
                                <text x="${offsetLeft + boxWidth/2}" y="${currentTop + boxHeight/2 + 2}" 
                                      text-anchor="middle" dominant-baseline="middle"
                                      class="text-xs font-bold fill-white" 
                                      style="font-family: 'Inter', sans-serif; pointer-events: none;"
                                      opacity="${opacity}">
                                    ${box.rotated ? '↻' : box.zigzag ? '⟲' : box.offset ? '⬢' : '□'}
                                </text>
                            </g>
                        `;
                        
                        currentLeft += boxWidth;
                    });
                    
                    currentTop += maxRowHeight;
                });
            }
            
            html += `
                        </g>
                        
                        <text x="${svgWidth/2}" y="${svgHeight - 20}" text-anchor="middle" 
                              class="text-sm font-semibold fill-gray-600" style="font-family: 'Inter', sans-serif;">
                            ${showAllLayers ? `Menampilkan Semua ${optimal.layers} Layer` : `Layer ${currentLayer + 1} dari ${optimal.layers} (Tinggi: ${(currentLayer * boxDimensions.height)} - ${((currentLayer + 1) * boxDimensions.height)} cm)`}
                        </text>
                    </svg>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function setupLayerControls() {
            if (!calculationResults) return;
            
            const { optimal } = calculationResults;
            
            // Show layer controls
            document.getElementById('layerControls').classList.remove('hidden');
            document.getElementById('layerControls').classList.add('jiffy-elastic');
            
            // Setup layer slider
            const layerSlider = document.getElementById('layerSlider');
            const layerDisplay = document.getElementById('layerDisplay');
            layerSlider.max = optimal.layers;
            layerDisplay.textContent = `1 / ${optimal.layers}`;
            
            // Create layer tabs
            const layerTabs = document.getElementById('layerTabs');
            layerTabs.innerHTML = '';
            
            for (let i = 1; i <= optimal.layers; i++) {
                const tab = document.createElement('button');
                tab.className = `layer-tab px-4 py-2 text-sm font-semibold border-2 border-gray-200 ${i === 1 ? 'active' : ''} jiffy-hover-lift`;
                tab.textContent = `Layer ${i}`;
                tab.onclick = () => selectLayer(i);
                layerTabs.appendChild(tab);
            }
        }

        function selectLayer(layerNum) {
            // Update slider
            document.getElementById('layerSlider').value = layerNum;
            document.getElementById('layerDisplay').textContent = `${layerNum} / ${calculationResults.optimal.layers}`;
            
            // Update active tab
            document.querySelectorAll('.layer-tab').forEach((tab, index) => {
                if (index + 1 === layerNum) {
                    tab.classList.add('active');
                    tab.classList.add('jiffy-bounce');
                    setTimeout(() => tab.classList.remove('jiffy-bounce'), 600);
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Update visualization
            if (currentVisualizationMode === '3d') {
                createBoxes3D();
            } else {
                create2DVisualization();
            }
        }

        function showSpecificLayer(layerNum) {
            document.getElementById('layerDisplay').textContent = `${layerNum} / ${calculationResults.optimal.layers}`;
            selectLayer(parseInt(layerNum));
        }

        function toggleLayerMode() {
            const showAll = document.getElementById('showAllLayers').checked;
            
            if (showAll) {
                document.getElementById('layerSlider').disabled = true;
                document.querySelectorAll('.layer-tab').forEach(tab => {
                    tab.disabled = true;
                    tab.classList.add('opacity-50');
                });
            } else {
                document.getElementById('layerSlider').disabled = false;
                document.querySelectorAll('.layer-tab').forEach(tab => {
                    tab.disabled = false;
                    tab.classList.remove('opacity-50');
                });
            }
            
            // Update visualization
            if (currentVisualizationMode === '3d') {
                createBoxes3D();
            } else {
                create2DVisualization();
            }
        }

        function resetCamera() {
            if (camera && controls) {
                camera.position.set(50, 50, 50);
                controls.reset();
                
                // Add animation feedback
                const button = event.target;
                button.classList.add('jiffy-bounce');
                setTimeout(() => button.classList.remove('jiffy-bounce'), 600);
                
                showJiffyAlert('Kamera direset ke posisi default', 'info');
            }
        }

        function toggleWireframe() {
            const wireframe = document.getElementById('wireframeMode').checked;
            
            boxMeshes.forEach(mesh => {
                mesh.material.wireframe = wireframe;
            });
            
            showJiffyAlert(wireframe ? 'Mode wireframe aktif' : 'Mode solid aktif', 'info');
        }

        function updateOpacity(value) {
            document.getElementById('opacityValue').textContent = value;
            
            boxMeshes.forEach(mesh => {
                mesh.material.opacity = parseFloat(value);
            });
        }

        function exportToPDF() {
            showJiffyAlert('Fitur export PDF sedang dalam pengembangan', 'info');
            
            // Add button animation
            const button = event.target;
            button.classList.add('jiffy-pulse');
            setTimeout(() => button.classList.remove('jiffy-pulse'), 2000);
        }

        // Window resize handler
        window.addEventListener('resize', function() {
            if (renderer && camera) {
                const threejsContainer = document.getElementById('threejs-container');
                camera.aspect = threejsContainer.clientWidth / 600;
                camera.updateProjectionMatrix();
                renderer.setSize(threejsContainer.clientWidth, 600);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c2f6f7d2e814a6',t:'MTc1NDY5NzUzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
